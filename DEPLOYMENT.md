# Инструкция по развертыванию AlcoControl

## Предварительные требования

- Docker и Docker Compose
- Node.js 16+ (для локальной разработки фронтенда)
- Python 3.9+ (для локальной разработки бэкенда)
- PostgreSQL (если не используете Docker)
- Telegram Bot Token (получить у @BotFather)

## Настройка окружения

1. Клонируйте репозиторий:
```bash
git clone https://github.com/yourusername/alcocontrol.git
cd alcocontrol
```

2. Создайте файл .env и настройте переменные окружения:
```bash
cp .env.example .env
# Отредактируйте .env, добавив свои значения
```

3. Создайте базу данных (если не используете Docker):
```bash
createdb alcocontrol
```

## Развертывание с использованием Docker

1. Соберите и запустите контейнеры:
```bash
docker-compose up --build
```

2. Примените миграции базы данных:
```bash
docker-compose exec backend alembic upgrade head
```

## Локальная разработка

### Бэкенд

1. Создайте виртуальное окружение:
```bash
python -m venv venv
source venv/bin/activate  # Linux/Mac
venv\Scripts\activate     # Windows
```

2. Установите зависимости:
```bash
pip install -r requirements.txt
```

3. Запустите сервер разработки:
```bash
uvicorn app.main:app --reload
```

### Фронтенд

1. Установите зависимости:
```bash
cd frontend
npm install
```

2. Запустите сервер разработки:
```bash
npm start
```

## Настройка Telegram бота

1. Создайте нового бота через @BotFather в Telegram
2. Получите токен бота
3. Добавьте токен в файл .env:
```
TELEGRAM_BOT_TOKEN=your_bot_token_here
```

4. Настройте веб-приложение в BotFather:
   - Отправьте команду /newapp
   - Выберите вашего бота
   - Укажите название и краткое описание
   - Загрузите иконку (опционально)
   - Получите URL веб-приложения

5. Добавьте URL веб-приложения в .env:
```
WEBAPP_URL=your_webapp_url_here
```

## Проверка работоспособности

1. Откройте бота в Telegram
2. Отправьте команду /start
3. Нажмите на кнопку "Открыть приложение"
4. Проверьте основные функции:
   - Добавление напитков
   - Отслеживание периодов трезвости
   - Просмотр статистики
   - Настройки

## Обновление

1. Остановите контейнеры:
```bash
docker-compose down
```

2. Получите последние изменения:
```bash
git pull
```

3. Пересоберите и запустите контейнеры:
```bash
docker-compose up --build -d
```

4. Примените миграции (если есть):
```bash
docker-compose exec backend alembic upgrade head
```

## Устранение неполадок

### Проблемы с базой данных

1. Проверьте подключение:
```bash
docker-compose exec db psql -U user -d alcocontrol
```

2. Сбросьте базу данных (если необходимо):
```bash
docker-compose down -v
docker-compose up -d
```

### Проблемы с бэкендом

1. Проверьте логи:
```bash
docker-compose logs backend
```

2. Перезапустите контейнер:
```bash
docker-compose restart backend
```

### Проблемы с фронтендом

1. Проверьте логи:
```bash
docker-compose logs frontend
```

2. Перезапустите контейнер:
```bash
docker-compose restart frontend
```

## Безопасность

1. Измените пароли по умолчанию в .env
2. Настройте SSL/TLS для продакшена
3. Регулярно обновляйте зависимости
4. Следите за логами на наличие подозрительной активности

## Мониторинг

1. Настройте мониторинг серверов
2. Добавьте логирование ошибок
3. Настройте оповещения о проблемах
4. Регулярно проверяйте использование ресурсов

## Резервное копирование

1. Настройте регулярное резервное копирование базы данных
2. Храните резервные копии в безопасном месте
3. Регулярно проверяйте возможность восстановления

## Масштабирование

1. Настройте балансировку нагрузки
2. Добавьте кэширование
3. Оптимизируйте запросы к базе данных
4. Настройте CDN для статических файлов 